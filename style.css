@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=VT323&display=swap');

:root {
    --md-sys-color-primary: #6750A4; /* M3 Primary Color */
    --md-sys-color-on-primary: #FFFFFF;
    --md-sys-color-secondary-container: #E8DEF8; /* For secondary buttons */
    --md-sys-color-on-secondary-container: #1D192B;
    --md-sys-color-surface: #FFFBFE; /* Page background */
    --md-sys-color-on-surface: #1C1B1F; /* Default text color */
    --md-sys-color-surface-container-high: #F3EDF7; /* Main menu card background */
    --md-sys-color-error: #B3261E; /* For "Menu" button */
    --md-sys-color-on-error: #FFFFFF;

    /* Game colors */
    --color-1: #F44336; --color-2: #2196F3; --color-3: #4CAF50;
    --color-4: #FFEB3B; --color-5: #9C27B0; --color-6: #FF9800;
    --color-7: #00BCD4; --color-8: #E91E63; --color-9: #FFFFFF;
}

body {
    font-family: 'Roboto', 'Orbitron', sans-serif;
    background-color: var(--md-sys-color-surface);
    color: var(--md-sys-color-on-surface);
    touch-action: manipulation;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    min-height: 100vh; /* Ensure body takes full viewport height */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

#main-menu {
    background-color: var(--md-sys-color-surface-container-high);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    width: 95%; /* Use percentage for width */
    max-width: 480px; /* Keep a max-width for larger screens */
    margin: auto; /* Center the menu */
}

.game-grid {
    display: grid;
    gap: 2vmin; /* Use vmin for responsive gap */
    padding: 2vmin; /* Use vmin for responsive padding */
    background-color: #1a1a2e;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5), inset 0 0 10px rgba(0,0,0,0.5);
    user-select: none;
    position: relative;
}

.game-grid.large-grid { gap: 1vmin; padding: 1vmin; }
.game-grid.large-grid .light { font-size: clamp(0.8rem, 2.5vmin, 1.2rem); border-width: 1px; }

.light {
    aspect-ratio: 1 / 1;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    border: 2px solid #0f0c29;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(1rem, 4vmin, 2rem); /* Responsive font size */
    font-weight: bold;
    color: rgba(255, 255, 255, 0.7);
    position: relative;
    overflow: hidden;
}

.light.is-on { background-color: var(--theme-color); box-shadow: 0 0 15px var(--theme-color), 0 0 25px var(--theme-color), inset 0 0 5px var(--theme-shadow-color); transform: scale(1.05); }
.light.is-highlight { transform: scale(1.1); border-color: #fef08a; box-shadow: 0 0 20px #fef08a; }
.light.is-off { background-color: #2c3e50; box-shadow: inset 0 0 10px rgba(0,0,0,0.7); }
.light.is-player-1 { background-color: var(--color-2); box-shadow: 0 0 15px var(--color-2); transform: scale(1); animation: drop 0.3s ease-out; }
.light.is-player-2 { background-color: var(--color-6); box-shadow: 0 0 15px var(--color-6); transform: scale(1); animation: drop 0.3s ease-out; }
.light.is-empty { background-color: #1a1a2e; box-shadow: inset 0 0 5px #000; }
.light.is-selected { border-color: #fde047; transform: scale(1.1); box-shadow: 0 0 20px #fde047; }
.light.is-mine { background-color: #ef4444; }
.light.is-revealed { background-color: #4b5563; color: #fff; cursor: default; }
.light.is-flagged::after { 
    content: '\001F6A9'; 
    font-size: 1.2rem;
    font-family: "Segoe UI Emoji", "Segoe UI Symbol", "Apple Color Emoji", "Twemoji Mozilla", "Noto Color Emoji", "Android Emoji";
}
.light.is-hidden { background-color: #374151; }
.light.line-dot::before { content: ''; display: block; width: 60%; height: 60%; border-radius: 50%; box-shadow: 0 0 10px #000; transition: transform 0.2s; }
.light.line-dot:hover::before { transform: scale(1.2); }
.light.color-1, .light.path-1, .light.color-1.line-dot::before, .light.echo-1 { background-color: var(--color-1); }
.light.color-2, .light.path-2, .light.color-2.line-dot::before, .light.echo-2 { background-color: var(--color-2); }
.light.color-3, .light.path-3, .light.color-3.line-dot::before, .light.echo-3 { background-color: var(--color-3); }
.light.color-4, .light.path-4, .light.color-4.line-dot::before, .light.echo-4 { background-color: var(--color-4); }
.light.color-5, .light.path-5, .light.color-5.line-dot::before, .light.echo-5 { background-color: var(--color-5); }
.light.color-6, .light.path-6, .light.color-6.line-dot::before, .light.echo-6 { background-color: var(--color-6); }
.light.color-7, .light.path-7, .light.color-7.line-dot::before, .light.echo-7 { background-color: var(--color-7); }
.light.echo-8 { background-color: var(--color-8); }
.light.echo-9 { background-color: var(--color-9); }
.light.is-feedback { background-color: #fde047; box-shadow: 0 0 20px #fde047, 0 0 30px #fde047; transform: scale(1.1); border-color: #fde047; }
.light.is-center-inactive { background-color: #111; cursor: not-allowed; }

.modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
.modal-backdrop.is-visible { opacity: 1; visibility: visible; }
.modal-content { background-color: var(--md-sys-color-surface-container-high); color: var(--md-sys-color-on-surface); padding: 1.5rem; border-radius: 28px; text-align: center; box-shadow: 0 4px 8px 3px rgba(0,0,0,0.15), 0 1px 3px rgba(0,0,0,0.3); transform: scale(0.9); transition: transform 0.3s ease; width: 90%; max-width: 90%; /* Adjusted for more flexibility */ position: relative; overflow: hidden; }
.modal-content .text-lg { color: var(--md-sys-color-on-surface-variant); }
.modal-content button { border: none; background-color: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); padding: 0.625rem 1.5rem; border-radius: 100px; font-weight: 500; text-transform: none; letter-spacing: 0.01em; cursor: pointer; transition: box-shadow 0.2s; margin-top: 1rem; }
.modal-content button:hover { box-shadow: 0 1px 3px 1px rgba(0,0,0,0.15), 0 1px 2px rgba(0,0,0,0.3); }
.modal-backdrop.is-visible .modal-content { transform: scale(1); }

.hidden { display: none; }
button:disabled, input:disabled { opacity: 0.5; cursor: not-allowed; }

.menu-button { background-color: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); border-radius: 20px; padding: 0.75rem 1rem; font-size: 0.875rem; text-transform: none; letter-spacing: 0.01em; box-shadow: 0 1px 3px rgba(0,0,0,0.2); border: none; display: flex; justify-content: center; align-items: center; width: 100%; min-height: 60px; margin-bottom: 1rem; line-height: 1.2; font-weight: bold; text-align: center; transition: all 0.15s ease-out; transform: translateY(0); }
.menu-button:hover { transform: translateY(-2px); box-shadow: 0 7px 20px rgba(0,0,0,0.35), inset 0 -4px 0 rgba(0,0,0,0.2); }
.menu-button:active { transform: translateY(1px) scale(0.98); box-shadow: 0 3px 10px rgba(0,0,0,0.3), inset 0 -2px 0 rgba(0,0,0,0.2); }

.control-button-icon { display: flex; align-items: center; justify-content: center; width: 48px; height: 48px; border-radius: 50%; background-color: transparent; color: var(--md-sys-color-primary); border: 1px solid #CAC4D0; cursor: pointer; transition: background-color 0.2s; }
.control-button-icon:hover { background-color: rgba(103, 80, 164, 0.08); }
.control-button-icon.btn-red { background-color: var(--md-sys-color-error); color: var(--md-sys-color-on-error); border: none; }
.control-button-icon.btn-green, .control-button-icon.btn-yellow { background-color: var(--md-sys-color-secondary-container); color: var(--md-sys-color-on-secondary-container); border: none; }
.control-button { padding: 0.75rem 1.25rem; font-weight: bold; border-radius: 8px; transition: all 0.15s ease-out; text-transform: uppercase; letter-spacing: 0.05em; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
.btn-blue { background-color: #3b82f6; color: white; } .btn-blue:hover { background-color: #2563eb; }
.btn-red { background-color: #ef4444; color: white; } .btn-red:hover { background-color: #dc2626; }
.btn-green { background-color: #22c55e; color: white; } .btn-green:hover { background-color: #16a34a; }
.btn-yellow { background-color: #f59e0b; color: white; } .btn-yellow:hover { background-color: #d97706; }
.btn-pink { background-color: #ec4899; color: white; } .btn-pink:hover { background-color: #db2777; }
.btn-orange { background-color: #f97316; color: white; } .btn-orange:hover { background-color: #ea580c; }
.btn-purple { background-color: #8e24aa; color: white; } .btn-purple:hover { background-color: #7b1fa2; }

.shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
.confetti-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; pointer-events: none; }
.confetti { position: absolute; width: 10px; height: 10px; background-color: #f00; opacity: 0.7; animation: confetti-fall 5s linear infinite; }

/* Wordle Styles */
.wordle-grid { gap: 5px; padding: 10px; }
.wordle-cell { font-size: clamp(1.75rem, 7vw, 3rem); text-transform: uppercase; transition: transform 0.6s, background-color 0.3s; transform-style: preserve-3d; }
.wordle-cell.flip .wordle-cell-inner { transform: rotateX(180deg); }
.wordle-cell-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
.wordle-cell-front, .wordle-cell-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 8px; }
.wordle-cell-front { background-color: #2c3e50; border: 2px solid #0f0c29; }
.wordle-cell-back { transform: rotateX(180deg); }
.wordle-cell-back.wordle-correct, .key.wordle-correct { background-color: #22c55e; border-color: #22c55e; color: white; }
.wordle-cell-back.wordle-present, .key.wordle-present { background-color: #f59e0b; border-color: #f59e0b; color: white; }
.wordle-cell-back.wordle-absent,  .key.wordle-absent  { background-color: #1f2937; border-color: #1f2937; color: #9ca3af; }

/* On-Screen Keyboard Styles */
.keyboard { display: flex; flex-direction: column; gap: 8px; width: 100%; max-width: 500px; margin: 0 auto; padding: 10px; }
.keyboard-row { display: flex; justify-content: center; gap: 6px; }
.key { height: 50px; flex-grow: 1; border: none; border-radius: 5px; background-color: #4b5563; color: white; font-size: 1rem; font-weight: bold; cursor: pointer; text-transform: uppercase; display: flex; align-items: center; justify-content: center; }
.key:hover { background-color: #6b7280; }
.key-large { flex-grow: 1.5; }
#keyboard-container .key.used { background-color: #1f2937; color: #4b5563; cursor: not-allowed; }

.win-line { position: absolute; background-color: var(--theme-color); height: 5px; border-radius: 5px; transform-origin: left center; box-shadow: 0 0 10px var(--theme-shadow-color); animation: draw-line 0.5s ease-out; }
#digital-clock { position: fixed; top: 0.5rem; right: 1rem; font-family: 'Orbitron', sans-serif; font-size: 1.25rem; color: var(--theme-color, #ef4444); text-shadow: 0 0 8px var(--theme-shadow-color, #f87171); z-index: 2000; transition: color 0.3s ease, text-shadow 0.3s ease; }

/* Keyboard Game & Music Studio Layout Styles */
#game-container.keyboard-active, #game-container.music-studio-active, #game-container.cryptogram-active { display: flex; flex-direction: column; height: 100vh; /* Use 100vh for full height */ }
#game-container.keyboard-active #game-board-wrapper, #game-container.cryptogram-active #game-board-wrapper { flex-grow: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding-bottom: 1rem; }
#game-container.keyboard-active #keyboard-container, #game-container.keyboard-active #game-controls, #game-container.cryptogram-active #game-controls, #game-container.cryptogram-active #keyboard-container { flex-shrink: 0; }

.global-back-button { margin-left: auto; }
.modal-content .control-button-icon { background-color: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); border: none; }

/* Music Studio Layout */
#game-container.music-studio-active #game-board-wrapper { flex-grow: 1; overflow-x: auto; overflow-y: hidden; -webkit-overflow-scrolling: touch; padding-bottom: 1rem; display: flex; align-items: stretch; }
.music-studio-main-container { display: flex; height: 100%; }
.note-labels-container { display: flex; flex-direction: column; height: 100%; margin-right: 1vmin; }
.note-label { flex-grow: 1; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #fff; border-radius: 4px; padding: 0 1vmin; font-family: 'Orbitron', sans-serif; font-size: clamp(0.8rem, 2.5vmin, 1.2rem); }
.music-studio-grid { display: grid; gap: 0.5vmin; padding: 0.5vmin; background-color: #1a1a2e; border-radius: 10px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.5), inset 0 0 10px rgba(0,0,0,0.5); user-select: none; position: relative; min-width: 100%; height: 100%; }
.music-studio-grid .light { aspect-ratio: 1 / 1; border-radius: 4px; transition: background-color 0.1s ease, transform 0.1s ease; }
.note-row-0 { background-color: #e53935; } .note-row-1 { background-color: #d81b60; }
.note-row-2 { background-color: #8e24aa; } .note-row-3 { background-color: #5e35b1; }
.note-row-4 { background-color: #3949ab; } .note-row-5 { background-color: #1e88e5; }
.note-row-6 { background-color: #039be5; } .note-row-7 { background-color: #00acc1; }
.music-studio-grid .light.is-player-1, .music-studio-grid .light.is-player-2 { transform: scale(1.1); box-shadow: 0 0 10px #fff, inset 0 0 5px rgba(255, 255, 255, 0.5); background-color: #fdd835 !important; }
.music-studio-grid .light.is-highlight { border: 2px solid #ffffff; transform: scale(1.15); }

/* Keyframes */
@keyframes confetti-fall { 0% { transform: translateY(-10vh) rotateZ(0deg); } 100% { transform: translateY(110vh) rotateZ(360deg); } }
@keyframes draw-line { from { transform: scaleX(0); } to { transform: scaleX(1); } }
@keyframes drop { 0% { transform: translateY(-100px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
@keyframes shake { 10%, 90% { transform: translateX(-1px); } 20%, 80% { transform: translateX(2px); } 30%, 50%, 70% { transform: translateX(-4px); } 40%, 60% { transform: translateX(4px); } }

/* =================================== */
/* Music Studio Instrument Colors      */
/* =================================== */

/* These override the default 'is-player-1' color based on the instrument */
/* The !important tag is necessary to ensure the specific color is applied */

.music-studio-grid .light.is-player-1.instrument-synth-lead {
    background-color: #fdd835 !important; /* Yellow */
}

.music-studio-grid .light.is-player-1.instrument-electric-piano {
    background-color: #42a5f5 !important; /* Blue */
}

.music-studio-grid .light.is-player-1.instrument-synth-strings {
    background-color: #ab47bc !important; /* Purple */
}

.music-studio-grid .light.is-player-1.instrument-brass-ensemble {
    background-color: #ffa726 !important; /* Orange */
}

.music-studio-grid .light.is-player-1.instrument-synth-bass {
    background-color: #ef5350 !important; /* Red */
}

/* Drum color remains distinct */
.music-studio-grid .light.is-player-2 {
    background-color: #66bb6a !important; /* Green */
    transform: scale(1.1);
    box-shadow: 0 0 10px #fff, inset 0 0 5px rgba(255, 255, 255, 0.5);
}
/* =================================== */
/* Music Studio Emoji Palette          */
/* =================================== */

.instrument-palette {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 8px;
    justify-content: center;
}

.instrument-emoji-button {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    border: 2px solid #555;
    background-color: #333;
    color: white;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

.instrument-emoji-button:hover {
    background-color: #444;
    transform: translateY(-2px);
}

.instrument-emoji-button.is-active {
    border-color: #fdd835;
    background-color: #555;
    box-shadow: 0 0 10px #fdd835;
}

/* Add a class to the grid cells for the emoji */
.music-studio-grid .light {
    font-size: 20px; /* Adjust emoji size */
    line-height: 1;
}

/* =================================== */
/* Note Playing Animation              */
/* =================================== */

@keyframes grow-note {
  0% { transform: scale(1.0); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1.0); }
}

.music-studio-grid .light.is-playing-note {
    animation: grow-note 0.15s ease-in-out;
}


/* =================================== */
/* New Instrument Colors               */
/* =================================== */

.music-studio-grid .light.instrument-electric-piano { background-color: #42a5f5 !important; }
.music-studio-grid .light.instrument-pluck { background-color: #26a69a !important; }
.music-studio-grid .light.instrument-bell { background-color: #ffee58 !important; }
.music-studio-grid .light.instrument-synth-strings { background-color: #ab47bc !important; }
.music-studio-grid .light.instrument-brass-ensemble { background-color: #ffa726 !important; }
.music-studio-grid .light.instrument-synth-bass { background-color: #ef5350 !important; }
.music-studio-grid .light.instrument-synth-lead { background-color: #ec407a !important; }
.music-studio-grid .light.instrument-gameboy { background-color: #78909c !important; }
.music-studio-grid .light.instrument-laser { background-color: #5c6bc0 !important; }
.music-studio-grid .light.instrument-click { background-color: #bdbdbd !important; }

/* Override the default player-1 color since we use specific instrument colors */
.music-studio-grid .light.is-player-1 {
    transform: scale(1.1);
    box-shadow: 0 0 10px #fff, inset 0 0 5px rgba(255, 255, 255, 0.5);
}

/* =================================== */
/* Cryptogram (Unmask) Styles          */
/* =================================== */

#game-container.cryptogram-active {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 1rem); /* Full viewport height minus some padding */
    max-height: -webkit-fill-available;
}

#game-container.cryptogram-active #game-board-wrapper {
    flex-grow: 1; /* Allows the puzzle area to take up available space */
    overflow-y: auto; /* Enables scrolling for the puzzle */
    -webkit-overflow-scrolling: touch;
    padding-bottom: 1rem;
}

#game-container.cryptogram-active #game-controls,
#game-container.cryptogram-active #keyboard-container {
    flex-shrink: 0; /* Prevents the controls and keyboard from shrinking */
}

.cryptogram-puzzle-container {
    display: flex;
    flex-wrap: wrap;
    gap: 2vmin; /* Responsive gap */
    padding: 2vmin;
    line-height: 1.5;
    font-family: 'VT323', monospace;
    justify-content: center;
}

.cryptogram-word {
    display: flex;
    gap: 0.5vmin; /* Responsive gap */
}

.cryptogram-cell {
    width: 7vmin; /* Responsive width */
    height: 14vmin; /* Responsive height */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    border-bottom: 2px solid #6b7280;
    position: relative;
    cursor: pointer;
}

.cryptogram-cell.punctuation {
    border-bottom: none;
    font-size: clamp(1.5rem, 5vmin, 2.5rem); /* Responsive font size */
    justify-content: flex-end;
    color: #cbd5e1;
}

.cipher-char {
    font-size: clamp(1rem, 3.5vmin, 2rem); /* Responsive font size */
    color: #6b7280;
    height: 50%;
    display: flex;
    align-items: center;
}

.plain-char {
    font-size: clamp(1.2rem, 4vmin, 2.2rem); /* Responsive font size */
    color: #fde047;
    height: 50%;
    width: 100%;
    text-align: center;
    font-weight: bold;
}

.cryptogram-cell.active .plain-char {
    background-color: rgba(253, 224, 71, 0.2);
    border-radius: 4px;
}

.cryptogram-cell.correct {
    border-color: #22c55e; /* Green underline on solve */
}
.cryptogram-cell.correct .plain-char {
    color: #22c55e; /* Green text on solve */
}

/* =================================== */
/* Anxiety Level Up Game Styles        */
/* =================================== */

.anxiety-level-up-active .game-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.anxiety-level-up-active .game-container {
    width: 100%;
    max-width: 420px;
    margin: auto;
    background-color: #16213e;
    border-radius: 1rem;
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.5), inset 0 0 15px #0f3460;
    color: #e3e3e3;
    padding: 2vmin; /* Responsive padding */
}

.anxiety-level-up-active .grid-wrapper {
    overflow: hidden;
    border-radius: 8px;
    position: relative;
    flex-grow: 1; /* Allow grid to take available space */
    display: flex;
    align-items: center;
    justify-content: center;
}

.anxiety-level-up-active .grid {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    grid-template-rows: repeat(10, 1fr);
    gap: 1vmin;
    aspect-ratio: 8 / 10;
    transition: filter 0.3s ease;
    width: 100%; /* Ensure grid fills its wrapper */
    height: 100%; /* Ensure grid fills its wrapper */
}

.anxiety-level-up-active .cell {
    border-radius: 4px;
    transition: transform 0.1s ease-in-out, box-shadow 0.2s ease;
    position: relative;
    cursor: pointer;
    background-color: rgba(0,0,0,0.2);
}

.anxiety-level-up-active .light {
    width: 100%;
    height: 100%;
    border-radius: 4px;
    transition: opacity 0.2s ease, transform 0.2s ease, background-color 0.2s ease;
    opacity: 0;
    transform: scale(0.5);
}

.anxiety-level-up-active .light.show {
    opacity: 1;
    transform: scale(1);
}

.anxiety-level-up-active .light.color-1 { background-color: #ff3860; box-shadow: 0 0 10px #ff3860, inset 0 0 5px rgba(255,255,255,0.3); }
.anxiety-level-up-active .light.color-2 { background-color: #38a1ff; box-shadow: 0 0 10px #38a1ff, inset 0 0 5px rgba(255,255,255,0.3); }
.anxiety-level-up-active .light.color-3 { background-color: #ffdd57; box-shadow: 0 0 10px #ffdd57, inset 0 0 5px rgba(255,255,255,0.3); }
.anxiety-level-up-active .light.color-4 { background-color: #48c774; box-shadow: 0 0 10px #48c774, inset 0 0 5px rgba(255,255,255,0.3); }
.anxiety-level-up-active .light.color-5 { background-color: #9750dd; box-shadow: 0 0 10px #9750dd, inset 0 0 5px rgba(255,255,255,0.3); }

.anxiety-level-up-active .cell.selected .light {
    transform: scale(1.1);
    box-shadow: 0 0 20px #fff, 0 0 30px #fff;
    z-index: 10;
}

.anxiety-level-up-active .light.clearing {
    animation: anxiety-flash-out 0.3s forwards;
}

@keyframes anxiety-flash-out {
    0% { opacity: 1; transform: scale(1.1); }
    50% { opacity: 1; transform: scale(1.2); background-color: #fff; box-shadow: 0 0 25px #fff; }
    100% { opacity: 0; transform: scale(0); }
}

@keyframes anxiety-drop-in {
    from { transform: translateY(-40px) scale(0.9); opacity: 0.5; }
    to { transform: translateY(0) scale(1); opacity: 1; }
}

.anxiety-level-up-active .light.dropping {
    animation: anxiety-drop-in 0.3s ease-out forwards;
}

.anxiety-level-up-active .preview-container {
    margin-bottom: 1rem;
    padding: 1vmin; /* Responsive padding */
    border: 2px solid #0f3460;
    border-radius: 0.75rem;
}

.anxiety-level-up-active .preview-row {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 1vmin;
    aspect-ratio: 8 / 1;
}

.anxiety-level-up-active .modal {
    background-color: rgba(26, 26, 46, 0.9);
    backdrop-filter: blur(5px);
}

@keyframes anxiety-level-up-anim {
    0% { transform: scale(1); color: #e3e3e3; }
    50% { transform: scale(1.3); color: #38a1ff; }
    100% { transform: scale(1); color: #e3e3e3; }
}

.anxiety-level-up-active .level-up {
    animation: anxiety-level-up-anim 0.5s ease-in-out;
}


/* =================================== */
/* Word Fall Game Styles               */
/* =================================== */

.word-fall-active .game-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.word-fall-active .game-container {
    width: 100%;
    max-width: 480px;
    margin: auto;
    background-color: #16213e;
    border-radius: 1rem;
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.5), inset 0 0 15px #0f3460;
    color: #e3e3e3;
    padding: 2vmin; /* Responsive padding */
}

.word-fall-active .grid-wrapper {
    overflow: hidden;
    border-radius: 8px;
    position: relative;
    flex-grow: 1; /* Allow grid to take available space */
    display: flex;
    align-items: center;
    justify-content: center;
}

.word-fall-active .grid {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    grid-template-rows: repeat(10, 1fr);
    gap: 1vmin;
    aspect-ratio: 8 / 10;
    transition: filter 0.3s ease;
    width: 100%; /* Ensure grid fills its wrapper */
    height: 100%; /* Ensure grid fills its wrapper */
}

.word-fall-active .grid.paused {
    filter: brightness(0) grayscale(100%);
}

.word-fall-active .cell {
    border-radius: 4px;
    transition: transform 0.1s ease-in-out, box-shadow 0.2s ease;
    position: relative;
    cursor: pointer;
    background-color: rgba(0,0,0,0.2);
}

.word-fall-active .light {
    width: 100%;
    height: 100%;
    border-radius: 4px;
    transition: opacity 0.2s ease, transform 0.2s ease, background-color 0.2s ease;
    opacity: 0;
    transform: scale(0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Roboto Mono', monospace;
    font-size: clamp(16px, 4vw, 24px);
    font-weight: 700;
    color: white;
    text-transform: uppercase;
    background-color: #4f46e5;
    box-shadow: 0 0 10px #4f46e5, inset 0 0 8px rgba(255,255,255,0.3);
}

.word-fall-active .light.show {
    opacity: 1;
    transform: scale(1);
}

.word-fall-active .cell.selected .light {
    transform: scale(1.1);
    box-shadow: 0 0 20px #a5b4fc, 0 0 30px #fff;
    z-index: 10;
}

.word-fall-active .light.clearing {
    animation: word-fall-flash-out 0.4s forwards;
}

@keyframes word-fall-flash-out {
    0% { opacity: 1; transform: scale(1.1); }
    50% { opacity: 1; transform: scale(1.3); background-color: #fff; color: #111; box-shadow: 0 0 25px #fff; }
    100% { opacity: 0; transform: scale(0); }
}

@keyframes word-fall-drop-in {
    from { transform: translateY(-100px) scale(0.9); opacity: 0; }
    to { transform: translateY(0) scale(1); opacity: 1; }
}

.word-fall-active .light.dropping {
    animation: word-fall-drop-in 0.3s ease-out forwards;
}

.word-fall-active .preview-container {
    margin-bottom: 1rem;
    padding: 1vmin; /* Responsive padding */
    border: 2px solid #0f3460;
    border-radius: 0.75rem;
}

.word-fall-active .preview-row {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 1vmin;
    height: 40px;
}

.word-fall-active .modal {
    background-color: rgba(26, 26, 46, 0.9);
    backdrop-filter: blur(5px);
}

@keyframes word-fall-level-up-anim {
    0% { transform: scale(1); color: #e3e3e3; }
    50% { transform: scale(1.3); color: #38a1ff; }
    100% { transform: scale(1); color: #e3e3e3; }
}

.word-fall-active .level-up {
    animation: word-fall-level-up-anim 0.5s ease-in-out;
}

.word-fall-active .word-display-container {
    height: 3rem;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.word-fall-active .word-display {
     font-family: 'Roboto Mono', monospace;
     color: #ffdd57;
     font-size: clamp(1rem, 3vw, 1.25rem); /* Responsive font size */
     letter-spacing: 0.1em;
     padding: 0.5rem;
     background-color: rgba(0,0,0,0.3);
     border-radius: 0.5rem;
     text-align: center;
     min-height: 2.5rem;
}

.word-fall-active .drop-button {
    background-color: #1d4ed8;
    color: white;
    font-family: 'Orbitron', sans-serif;
    transition: background-color 0.2s, transform 0.1s;
}

.word-fall-active .drop-button:hover:not(:disabled) {
    background-color: #2563eb;
    transform: translateY(-2px);
}

.word-fall-active .drop-button:active:not(:disabled) {
    transform: translateY(0);
}

.word-fall-active .drop-button:disabled {
    background-color: #4b5563;
    cursor: not-allowed;
    opacity: 0.7;
}

.word-fall-active .mode-selector {
    border: 2px solid #0f3460;
    transition: background-color 0.2s, border-color 0.2s;
}

.word-fall-active .mode-selector.active {
    background-color: #4f46e5;
    border-color: #a5b4fc;
}


/* =================================== */
/* Fix for Word Fall Game Style Mismatch */
/* =================================== */

.word-fall-active .game-container {
    display: flex;
    flex-direction: column;
}

.word-fall-active .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.word-fall-active .header-left {
    display: flex;
    align-items: baseline;
    gap: 1rem;
}

.word-fall-active .header-right {
    text-align: right;
}

.word-fall-active .header h1 {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    color: white;
}

.word-fall-active .info-label {
    font-weight: 600;
    font-size: 1.125rem;
}

.word-fall-active .info-value {
    font-weight: 700;
    font-size: 1.125rem;
}

.word-fall-active #level.info-value { color: #7dd3fc; }
.word-fall-active #score.info-value { color: #fde047; }

.word-fall-active .word-display-container { margin-bottom: 1rem; }

.word-fall-active .preview-title {
    text-align: center;
    font-size: 0.875rem;
    color: #9ca3af;
    margin-bottom: 0.5rem;
}

.word-fall-active .controls-area { margin-top: 1rem; }

.word-fall-active .pause-button {
    width: 100%;
    padding: 0.75rem 0;
    margin-top: 0.5rem;
    border-radius: 0.5rem;
    font-size: 1.25rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    background-color: #4b5563;
    color: white;
    transition: transform 0.2s, background-color 0.2s;
    border: none;
    cursor: pointer;
}
.word-fall-active .pause-button:hover {
    background-color: #6b7280;
    transform: scale(1.05);
}

.word-fall-active .timer-display-container {
    text-align: center;
    font-size: 0.875rem;
    color: #9ca3af;
}
.word-fall-active .timer-display-container.hidden { display: none; }


.word-fall-active #interval-display {
    font-weight: 700;
    color: #67e8f9;
}

.word-fall-active .modal {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    z-index: 20;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 1rem;
}
.word-fall-active .modal.hidden { display: none; }


.word-fall-active .modal-content {
    background-color: #1f2937;
    padding: 2rem;
    border-radius: 1rem;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    border-width: 2px;
    border-style: solid;
    max-width: 32rem;
}

.word-fall-active #game-over-modal .modal-content { border-color: #ef4444; }
.word-fall-active #start-modal .modal-content { border-color: #3b82f6; }

.word-fall-active .modal-title {
    font-weight: 700;
    letter-spacing: 0.1em;
    margin-bottom: 1rem;
}

.word-fall-active #game-over-modal .modal-title {
    font-size: 3rem;
    color: #ef4444;
}

.word-fall-active #start-modal .modal-title {
    font-size: 2.25rem;
    color: #60a5fa;
}

.word-fall-active .modal-body {
    font-size: 1.25rem;
    margin-bottom: 1.5rem;
}
.word-fall-active .modal-body p { margin-bottom: 0.5rem; }
.word-fall-active .modal-body .final-score-value {
    font-weight: 700;
    color: #fde047;
}
.word-fall-active .modal-body .start-description {
    color: #d1d5db;
    font-size: 1.125rem;
    margin-bottom: 1.5rem;
}


.word-fall-active .modal-button {
    font-weight: 700;
    padding: 0.75rem 2rem;
    border-radius: 0.5rem;
    font-size: 1.25rem;
    transition: transform 0.2s, background-color 0.2s;
    color: white;
    border: none;
    cursor: pointer;
}
.word-fall-active .modal-button:hover { transform: scale(1.05); }

.word-fall-active #view-words-button {
    background-color: #9333ea;
    margin-bottom: 1rem;
}
.word-fall-active #view-words-button:hover { background-color: #a855f7; }

.word-fall-active #restart-button { background-color: #2563eb; }
.word-fall-active #restart-button:hover { background-color: #3b82f6; }

.word-fall-active #start-button {
    background-color: #16a34a;
    font-size: 1.5rem;
}
.word-fall-active #start-button:hover { background-color: #22c55e; }

.word-fall-active .mode-selection {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.word-fall-active .mode-selector {
    padding: 1rem;
    width: 10rem;
    cursor: pointer;
    border-radius: 0.5rem;
}
.word-fall-active .mode-selector h3 {
    font-weight: 700;
    font-size: 1.25rem;
}
.word-fall-active .mode-selector p {
    font-size: 0.875rem;
    color: #d1d5db;
}

.word-fall-active #level-select-container { margin-bottom: 2rem; }
.word-fall-active #level-select-container label {
    color: #9ca3af;
    margin-right: 0.5rem;
    font-size: 1.125rem;
}
.word-fall-active #level-select {
    background-color: #374151;
    color: white;
    padding: 0.5rem;
    border-radius: 0.5rem;
    font-size: 1.125rem;
    border: none;
}
.word-fall-active #level-select:focus { outline: 2px solid #3b82f6; }

.word-list-modal-content {
    background-color: #1f2937;
    padding: 1.5rem;
    border-radius: 1rem;
    border: 2px solid #3b82f6;
    max-width: 90vw;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
}
.modal-backdrop {
    display: none; /* controlled by JS */
}
.modal-backdrop.flex {
    display: flex;
}
.word-list-scroll-container {
    overflow-y: auto;
    max-height: 60vh;
    padding: 0.5rem;
    border-radius: 0.25rem;
    background-color: #374151;
}
#found-words-list {
    list-style-type: disc;
    list-style-position: inside;
    text-align: left;
}
#close-word-list-modal {
    background-color: #2563eb;
    color: white;
    font-weight: 700;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    margin-top: 1rem;
    border: none;
    cursor: pointer;
}
#close-word-list-modal:hover {
    background-color: #3b82f6;
}